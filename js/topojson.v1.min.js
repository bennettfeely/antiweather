!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(n.topojson=n.topojson||{})}(this,(function(n){"use strict";function t(n){if(!n)return a;var t,r,e=n.scale[0],o=n.scale[1],i=n.translate[0],u=n.translate[1];return function(n,f){f||(t=r=0),n[0]=(t+=n[0])*e+i,n[1]=(r+=n[1])*o+u}}function r(n,t){for(var r=0,e=n.length;r<e;){var o=r+e>>>1;n[o]<t?r=o+1:e=o}return r}function e(n,t){var r={type:"Feature",id:t.id,properties:t.properties||{},geometry:o(n,t)};return null==t.id&&delete r.id,r}function o(n,r){function e(n,t){t.length&&t.pop();for(var r,e=a[n<0?~n:n],o=0,i=e.length;o<i;++o)t.push(r=e[o].slice()),c(r,o);n<0&&function(n,t){for(var r,e=n.length,o=e-t;o<--e;)r=n[o],n[o++]=n[e],n[e]=r}(t,i)}function o(n){return n=n.slice(),c(n,0),n}function i(n){for(var t=[],r=0,o=n.length;r<o;++r)e(n[r],t);return t.length<2&&t.push(t[0].slice()),t}function u(n){for(var t=i(n);t.length<4;)t.push(t[0].slice());return t}function f(n){return n.map(u)}var c=t(n.transform),a=n.arcs,s={Point:function(n){return o(n.coordinates)},MultiPoint:function(n){return n.coordinates.map(o)},LineString:function(n){return i(n.arcs)},MultiLineString:function(n){return n.arcs.map(i)},Polygon:function(n){return f(n.arcs)},MultiPolygon:function(n){return n.arcs.map(f)}};return function n(t){var r=t.type;return"GeometryCollection"===r?{type:r,geometries:t.geometries.map(n)}:r in s?{type:r,coordinates:s[r](t)}:null}(r)}function i(n,t,r){function e(n){var t=n<0?~n:n;(a[t]||(a[t]=[])).push({i:n,g:c})}function o(n){n.forEach(e)}function i(n){n.forEach(o)}function u(n){"GeometryCollection"===n.type?n.geometries.forEach(u):n.type in l&&(c=n,l[n.type](n.arcs))}var f=[];if(arguments.length>1){var c,a=[],l={LineString:o,MultiLineString:i,Polygon:i,MultiPolygon:function(n){n.forEach(i)}};u(t),a.forEach(arguments.length<3?function(n){f.push(n[0].i)}:function(n){r(n[0].g,n[n.length-1].g)&&f.push(n[0].i)})}else for(var h=0,p=n.arcs.length;h<p;++h)f.push(h);return{type:"MultiLineString",arcs:s(n,f)}}function u(n){var t=n[0],r=n[1],e=n[2];return Math.abs((t[0]-e[0])*(r[1]-t[1])-(t[0]-r[0])*(e[1]-t[1]))}function f(n,t){function r(n){n.forEach((function(t){t.forEach((function(t){(i[t=t<0?~t:t]||(i[t]=[])).push(n)}))})),u.push(n)}function e(t){return Math.abs(function(n){for(var t,r=-1,e=n.length,o=n[e-1],i=0;++r<e;)t=o,o=n[r],i+=t[0]*o[1]-t[1]*o[0];return i/2}(o(n,{type:"Polygon",arcs:[t]}).coordinates[0]))}var i={},u=[],f=[];return t.forEach((function(n){"Polygon"===n.type?r(n.arcs):"MultiPolygon"===n.type&&n.arcs.forEach(r)})),u.forEach((function(n){if(!n._){var t=[],r=[n];for(n._=1,f.push(t);n=r.pop();)t.push(n),n.forEach((function(n){n.forEach((function(n){i[n<0?~n:n].forEach((function(n){n._||(n._=1,r.push(n))}))}))}))}})),u.forEach((function(n){delete n._})),{type:"MultiPolygon",arcs:f.map((function(t){var r,o=[];if(t.forEach((function(n){n.forEach((function(n){n.forEach((function(n){i[n<0?~n:n].length<2&&o.push(n)}))}))})),(r=(o=s(n,o)).length)>1)for(var u,f,c=1,a=e(o[0]);c<r;++c)(u=e(o[c]))>a&&(f=o[0],o[0]=o[c],o[c]=f,a=u);return o}))}}function c(n,t){return n[1][2]-t[1][2]}var a=function(){},s=function(n,t){function r(t){var r,e=n.arcs[t<0?~t:t],o=e[0];return n.transform?(r=[0,0],e.forEach((function(n){r[0]+=n[0],r[1]+=n[1]}))):r=e[e.length-1],t<0?[r,o]:[o,r]}function e(n,t){for(var r in n){var e=n[r];delete t[e.start],delete e.start,delete e.end,e.forEach((function(n){o[n<0?~n:n]=1})),f.push(e)}}var o={},i={},u={},f=[],c=-1;return t.forEach((function(r,e){var o,i=n.arcs[r<0?~r:r];i.length<3&&!i[1][0]&&!i[1][1]&&(o=t[++c],t[c]=r,t[e]=o)})),t.forEach((function(n){var t,e,o=r(n),f=o[0],c=o[1];if(t=u[f])if(delete u[t.end],t.push(n),t.end=c,e=i[c]){delete i[e.start];var a=e===t?t:t.concat(e);i[a.start=t.start]=u[a.end=e.end]=a}else i[t.start]=u[t.end]=t;else if(t=i[c])if(delete i[t.start],t.unshift(n),t.start=f,e=u[f]){delete u[e.end];var s=e===t?t:e.concat(t);i[s.start=e.start]=u[s.end=t.end]=s}else i[t.start]=u[t.end]=t;else i[(t=[n]).start=f]=u[t.end=c]=t})),e(u,i),e(i,u),t.forEach((function(n){o[n<0?~n:n]||f.push([n])})),f};n.mesh=function(n){return o(n,i.apply(this,arguments))},n.meshArcs=i,n.merge=function(n){return o(n,f.apply(this,arguments))},n.mergeArcs=f,n.feature=function(n,t){return"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map((function(t){return e(n,t)}))}:e(n,t)},n.neighbors=function(n){function t(n,t){n.forEach((function(n){n<0&&(n=~n);var r=o[n];r?r.push(t):o[n]=[t]}))}function e(n,r){n.forEach((function(n){t(n,r)}))}var o={},i=n.map((function(){return[]})),u={LineString:t,MultiLineString:e,Polygon:e,MultiPolygon:function(n,t){n.forEach((function(n){e(n,t)}))}};for(var f in n.forEach((function n(t,r){"GeometryCollection"===t.type?t.geometries.forEach((function(t){n(t,r)})):t.type in u&&u[t.type](t.arcs,r)})),o)for(var c=o[f],a=c.length,s=0;s<a;++s)for(var l=s+1;l<a;++l){var h,p=c[s],v=c[l];(h=i[p])[f=r(h,v)]!==v&&h.splice(f,0,v),(h=i[v])[f=r(h,p)]!==p&&h.splice(f,0,p)}return i},n.presimplify=function(n,r){function e(n){f.remove(n),n[1][2]=r(n),f.push(n)}var o=t(n.transform),i=function(n){if(!n)return a;var t,r,e=n.scale[0],o=n.scale[1],i=n.translate[0],u=n.translate[1];return function(n,f){f||(t=r=0);var c=Math.round((n[0]-i)/e),a=Math.round((n[1]-u)/o);n[0]=c-t,n[1]=a-r,t=c,r=a}}(n.transform),f=function(){function n(n,t){for(;t>0;){var r=(t+1>>1)-1,o=e[r];if(c(n,o)>=0)break;e[o._=t]=o,e[n._=t=r]=n}}function t(n,t){for(;;){var r=t+1<<1,i=r-1,u=t,f=e[u];if(i<o&&c(e[i],f)<0&&(f=e[u=i]),r<o&&c(e[r],f)<0&&(f=e[u=r]),u===t)break;e[f._=t]=f,e[n._=t=u]=n}}var r={},e=[],o=0;return r.push=function(t){return n(e[t._=o]=t,o++),o},r.pop=function(){if(!(o<=0)){var n,r=e[0];return--o>0&&(n=e[o],t(e[n._=0]=n,0)),r}},r.remove=function(r){var i,u=r._;if(e[u]===r)return u!==--o&&(c(i=e[o],r)<0?n:t)(e[i._=u]=i,u),u},r}();return null==r&&(r=u),n.arcs.forEach((function(n){var t,u,c,a,s=[],l=0;for(u=0,c=n.length;u<c;++u)a=n[u],o(n[u]=[a[0],a[1],1/0],u);for(u=1,c=n.length-1;u<c;++u)(t=n.slice(u-1,u+2))[1][2]=r(t),s.push(t),f.push(t);for(u=0,c=s.length;u<c;++u)(t=s[u]).previous=s[u-1],t.next=s[u+1];for(;t=f.pop();){var h=t.previous,p=t.next;t[1][2]<l?t[1][2]=l:l=t[1][2],h&&(h.next=p,h[2]=t[2],e(h)),p&&(p.previous=h,p[0]=t[0],e(p))}n.forEach(i)})),n},Object.defineProperty(n,"__esModule",{value:!0})}));