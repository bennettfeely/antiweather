var dark_sky_api_key="e6c964e768708278b2dd1e5393296b2e",google_places_api_key="AIzaSyBwmxzDlhMqLhObyOGd8ai-hnxmQO8k1Bs";function init(){var e=store.get("antiweather-units");null!==e&&(document.querySelector('[value="'+e+'"]').checked=!0),setupMap("home",40.4406,-79.9959),setupMap("away",-40.4406,100.0041),getLocation(),document.querySelector("#c_toggle").addEventListener("change",changeUnits),document.querySelector("#f_toggle").addEventListener("change",changeUnits)}function changeUnits(){var e=document.querySelector('[name="units-toggle"]:checked').value;store("antiweather-units",e);var t=document.querySelector(".home").getAttribute("data-lng"),a=document.querySelector(".home").getAttribute("data-lat"),r=document.querySelector(".away").getAttribute("data-lng"),i=document.querySelector(".away").getAttribute("data-lat");null!==t&&null!==a&&null!==r&&null!==i&&(getWeather("home",parseInt(a),parseInt(t)),getWeather("away",parseInt(i),parseInt(r)))}function getLocation(){var e=document.getElementById("search"),t=new google.maps.places.Autocomplete(e,{types:["(cities)"],placeIdOnly:!0}),r=new google.maps.Geocoder;t.addListener("place_changed",function(){var a=t.getPlace();a.place_id&&r.geocode({placeId:a.place_id},function(e,t){"OK"===t?(initSearch(e[0].geometry.location.lat(),e[0].geometry.location.lng()),console.log(a),setLocation("home",a.name)):window.alert("Geocoder failed due to: "+t)})})}function initSearch(e,t){document.querySelector("#search").click();var a=-1*e;if(0<(r=-1*t))var r=-(r-180);else r=-(r+180);getWeather("home",e,t),getWeather("away",a,r)}function getPlacename(t,e,a){loadJSONP("https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat="+e+"&lon="+a+"&zoom=5&namedetails=1&addressdetails=0","json_callback",function(e){null==e.name||"Unable to geocode"==e.error?setLocation(t,"Middle of Nowhere"):setLocation(t,e.name)})}function setLocation(e,t){fill(e,"location",t),fill("quick-"+e,"quick-location",t),fill(e,"forecast-heading","Middle of Nowhere"==t||"North Pole"==t||"South Pole"==t?"Forecast for the "+t:"Pittsburgh"==t?"Forecast for the City of Champions":"Forecast for "+t)}function getWeather(t,a,r,i){document.querySelector("."+t).classList.remove("has-weather"),document.querySelector(".quick-wrapper").classList.remove("has-weather"),document.querySelector("html").classList.add("is-loading"),document.querySelector("."+t).classList.add("is-loading-"+t),document.querySelector("."+t).setAttribute("data-lat",a),document.querySelector("."+t).setAttribute("data-lng",r);var e=document.querySelector('[name="units-toggle"]:checked').value,n="https://api.darksky.net/forecast/"+dark_sky_api_key+"/"+a+","+r+"?units="+e+"&exclude=alerts,hourly,minutely";console.log(n),loadJSONP(n,"callback",function(e){extractWeather(t,a,r,i,e)})}function extractWeather(e,t,a,r,i){fillCurrentlyCard({apparentTemperature:i.currently.apparentTemperature,cloudCover:i.currently.cloudCover,currentlySummary:i.currently.summary,currentTime:i.currently.time,dailySummary:i.daily.summary,dewPoint:i.currently.dewPoint,humidity:i.currently.humidity,icon:i.currently.icon,lat:t,lng:a,location:e,ozone:i.currently.ozone,pre_placename:r,pressure:i.currently.pressure,sunriseTime:i.daily.data[0].sunriseTime,sunsetTime:i.daily.data[0].sunsetTime,temperature:i.currently.temperature,timezone:i.timezone,units:i.flags.units,uv:i.currently.uvIndex,visibility:i.currently.visibility,windBearing:i.currently.windBearing,windGust:i.currently.windGust,windSpeed:i.currently.windSpeed}),makeForecastCard({forecast:i.daily,location:e,timezone:i.timezone,units:i.flags.units})}function fillCurrentlyCard(e){var t=e.location;if(void 0!==e.temperature&&cardColor(t,e.units,e.temperature),setupMap(t,e.lat,e.lng),void 0!==e.lat&&void 0!==e.lng){var a=_formatCoords(e.lat,e.lng);fill(t,"coordinates",a)}else fill(t,"coordinates","Coordinates not available");if(void 0!==e.pre_placename?setLocation(t,e.pre_placename):"away"==t&&getPlacename("away",e.lat,e.lng),void 0!==e.temperature){var r='<svg><use xlink:href="#'+e.icon+'"></use></svg>',i=_formatTemp(e.temperature);fill(t,"temperature",r+i),fill("quick-"+t,"quick-temperature",i)}else fill(t,"temperature",r+"--&deg;"),fill("quick-"+t,"quick-temperature","--&deg;");var n=_formatSummary(e);fill(t,"summary",n),fill("quick-"+t,"quick-summary",e.currentlySummary);var o=moment.unix(e.currentTime).tz(e.timezone).format("h:mm a");fill(t,"time",o);var l=moment.unix(e.currentTime).tz(e.timezone).format("dddd, MMMM Do");fill(t,"date",l);var s=_formatTemp(e.apparentTemperature);if(fill(t,"apparenttemperature",s),void 0!==e.cloudCover){var u=_formatPct(e.cloudCover);fill(t,"cloudcover",u)}else fill(t,"cloudcover",'<span class="not-available">N/A</span>');if(void 0!==e.windSpeed){var c=_formatSpeed(e.windSpeed,e.units);if(void 0!==e.windBearing)var m=c+" "+_formatBearing(e.windBearing);else m=c;fill(t,"wind",m)}else fill(t,"wind",'<span class="not-available">N/A</span>');if(void 0!==e.windGust){var d=_formatSpeed(e.windGust,e.units);fill(t,"windgust",d)}else fill(t,"windgust",'<span class="not-available">N/A</span>');if(void 0!==e.humidity){var f=_formatPct(e.humidity);fill(t,"humidity",f)}else fill(t,"humidity",'<span class="not-available">N/A</span>');if(void 0!==e.dewPoint){var p=_formatTemp(e.dewPoint);fill(t,"dewpoint",p)}else fill(t,"dewpoint",'<span class="not-available">N/A</span>');if(void 0!==e.pressure){var v=_formatPressure(e.pressure,e.units);fill(t,"pressure",v)}else fill(t,"pressure",'<span class="not-available">N/A</span>');if(void 0!==e.uv){var y=_formatUv(e.uv);fill(t,"uv",y)}else fill(t,"uv",'<span class="not-available">N/A</span>');if(void 0!==e.ozone){var g=_formatOzone(e.ozone);fill(t,"ozone",g)}else fill(t,"ozone",'<span class="not-available">N/A</span>');if(void 0!==e.visibility){var h=_formatDistance(e.visibility,e.units);fill(t,"visibility",h)}else fill(t,"visibility",'<span class="not-available">N/A</span>');if(void 0!==e.sunriseTime){var S=moment.unix(e.sunriseTime).tz(e.timezone).format("h:mm a");fill(t,"sunrise",S)}else fill(t,"sunrise",'<span class="not-available">N/A</span>');if(void 0!==e.sunsetTime){var w=moment.unix(e.sunsetTime).tz(e.timezone).format("h:mm a");fill(t,"sunset",w)}else fill(t,"sunset",'<span class="not-available">N/A</span>');setTimeout(function(){document.querySelector("html").classList.remove("is-loading"),document.querySelector("."+t).classList.remove("is-loading-"+t),document.querySelector("."+t).classList.add("has-weather"),document.querySelector(".quick-"+t).classList.remove("is-loading-"+t),document.querySelector(".quick-wrapper").classList.add("has-weather")},400)}function cardColor(e,t,a){document.querySelector("."+e).classList.remove("temp-0","temp-1","temp-2","temp-3","temp-4","temp-5","temp-6","temp-7","temp-8","temp-9","temp-10"),document.querySelector(".quick-"+e).classList.remove("temp-0","temp-1","temp-2","temp-3","temp-4","temp-5","temp-6","temp-7","temp-8","temp-9","temp-10");var r=cardColorScale(t,a);document.querySelector("."+e).classList.add(r),document.querySelector(".quick-"+e).classList.add(r)}function cardColorScale(e,t){if("us"==e||"uk2"==e){if(100<=t)var a=10;else if(90<=t)a=9;else if(80<=t)a=8;else if(70<=t)a=7;else if(60<=t)a=6;else if(50<=t)a=5;else if(40<=t)a=4;else if(30<=t)a=3;else if(20<=t)a=2;else if(10<=t)a=1;else if(t<10)a=0}else if("si"==e||"ca"==e)if(37.7<=t)a=10;else if(32.2<=t)a=9;else if(26.7<=t)a=8;else if(21.1<=t)a=7;else if(15.6<=t)a=6;else if(10<=t)a=5;else if(4.4<=t)a=4;else if(-1.1<=t)a=3;else if(-6.7<=t)a=2;else if(-12.2<=t)a=1;else if(t<-17.8)a=0;return"temp-"+a}function setupMap(e,i,n){document.querySelector("."+e+" .map").innerHTML="";var o=1e3,l={type:"Sphere"},s=d3.geo.orthographic().scale(o/2.1).clipAngle(90).translate([500,500]),u=d3.geo.graticule(),c=d3.select("."+e+" .map").append("canvas").attr("width",o).attr("height",o).node().getContext("2d"),m=d3.geo.path().projection(s).context(c);d3.scale.linear().domain([0,o]).range([-180,180]),d3.scale.linear().domain([0,o]).range([90,-90]);d3.json("src/world-110m.json",function(e,t){if(e)throw e;var a=topojson.feature(t,t.objects.land),r=u();c.clearRect(0,0,o,o),c.beginPath(),m(l),c.fillStyle="rgba(0,0,0,.3)",c.fill(),c.save(),c.translate(500,0),c.scale(-1,1),c.translate(-500,0),s.rotate([n,i]),c.restore(),s.rotate([-n,-i]),c.beginPath(),m(a),c.fillStyle="rgba(255,255,255,.9)",c.fill(),c.beginPath(),m(r),c.lineWidth=2,c.strokeStyle="rgba(128,128,128,.2)",c.stroke()}),d3.select(self.frameElement).style("height",o+"px")}function makeForecastCard(e){var t=e.location;for(document.querySelector("."+t+" .forecast-wrapper").innerHTML="",i=0;i<e.forecast.data.length;i++){var a=e.forecast.data[i],r=moment.unix(a.time).tz(e.timezone).format("dddd");moment.unix(a.time).tz(e.timezone).format("MMM Do");if(void 0!==a.summary)a.summary;else;if(void 0!==a.icon)var n='<svg class="forecast-icon"><use xlink:href="#'+a.icon+'"></use></svg>';else n='<svg><use xlink:href="#clear"></use></svg>';if(void 0!==a.temperatureHigh)var o=_formatTemp(a.temperatureHigh),l=" "+cardColorScale(e.units,a.temperatureHigh);else o="--&deg;",l="";if(void 0!==a.temperatureLow)var s=_formatTemp(a.temperatureLow);else s="--&deg;";append(t,"forecast-wrapper",'<div class="forecast-item-wrapper full'+l+'" tabindex="1"><div class="forecast-item"><div class="forecast-day-wrapper"><div class="forecast-day">'+r+'</div></div><div class="forecast-temperature-wrapper">'+n+'<div class="forecast-temperature high">'+o+'</div><div class="forecast-temperature low">'+s+"</div></div></div></div>")}}document.addEventListener("DOMContentLoaded",init,!1);var loadJSONP=function(){var o=0;return function(e,t,a,r){var i="_jsonp_"+o++;e+="&"+t+"="+i;var n=document.createElement("script");n.type="text/javascript",n.src=e,window[i]=function(e){a.call(r||window,e),document.getElementsByTagName("head")[0].removeChild(n),n=null,delete window[i]},document.getElementsByTagName("head")[0].appendChild(n)}}();function fill(e,t,a){document.querySelector("."+e+" ."+t).innerHTML=a}function append(e,t,a){document.querySelector("."+e+" ."+t).innerHTML+=a}function _formatCoords(e,t){return e.toFixed(4)+", "+t.toFixed(4)}function _formatTemp(e){return Math.round(e)+"&deg;"}function _formatSummary(e){if(void 0!==e.currentlySummary)var t=_formatCurrentlySummary(e.currentlySummary);else t="";if(void 0!==e.dailySummary)var a=e.dailySummary;else a="";return null==e.currentlySummary&&null==e.dailySummary?"Weekly forecast summary not available.":t+a}function _formatCurrentlySummary(e){return(e=e.toLowerCase()).charAt(0).toUpperCase()+e.slice(1)+". "}function _formatPct(e){return Math.round(100*e)+"%"}function _formatSpeed(e,t){if("us"==t||"uk2"==t)var a="mph";if("si"==t||"ca"==t)a="km/h";return Math.round(e)+" "+a}function _formatPressure(e,t){if("us"==t||"uk2"==t)var a="mb";if("si"==t||"ca"==t)a="hPa";return Math.round(e)+" "+a}function _formatDistance(e,t){if("us"==t||"uk2"==t)var a="mi";if("si"==t||"ca"==t)a="km";return Math.round(e)+" "+a}function _formatBearing(e){return["N","NE","E","SE","S","SW","W","NW"][Math.floor(e/22.5+.5)%8]}function _formatUv(e){if(11<e)var t="Extreme";else if(8<e)t="Very high";else if(6<e)t="High";else if(3<e)t="Moderate";else t="Low";return e+" ("+t+")"}function _formatOzone(e){return Math.round(e)+" DU"}